<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/new_payroll_form.css">
  <title>Employee payroll form</title>
  <script defer src="../js/new_payroll_form.js"></script>
  </head>
<body>
  <!-- UC 1 -->
  <header class="header-content header"> 
    <div class="logo-content">
      <img src="../assets/images/logo.png" alt="">
      <div>
        <span class="emp-text">EMPLOYEE</span><br>
        <span class="emp-text emp-payroll">PAYROLL</span>
      </div>
    </div>
  </header>
  <div class="form-content">
    <form class="form" action="#" onsubmit="save();return false">
      <!-- UC 2 -->
      <div class="form-head"> Employee Payroll form </div>
      <div class="row-content">
          <label class="label text" for="name">Name</label>
          <input class="input" type="text" id="name" name="name" 
                  placeholder="Your name.." required>
          <error-output class="name-error" for="text" ></error-output>        
      </div>
      <!-- UC 3 -->
      <div class="row-content">
        <label class="label text" for="profile">Profile image</label>
        <div class="profile-radio-content">
          <label>
            <input type="radio" id="profile1" name="profile" 
                    value="../assets/profile-images/Ellipse -3.png" required>
            <img class="profile" id='image1' src="../assets/profile-images/Ellipse -3.png">
          </label>
          <label>
            <input type="radio" id="profile2" name="profile" 
                    value="../assets/profile-images/Ellipse 1.png" required>
            <img class="profile" id='image2' src="../assets/profile-images/Ellipse 1.png">
          </label>
          <label>
            <input type="radio" id="profile3" name="profile" 
                    value="../assets/profile-images/Ellipse -8.png" required>
            <img class="profile" id='image3' src="../assets/profile-images/Ellipse -8.png">
          </label>
          <label>
            <input type="radio" id="profile4" name="profile" 
                    value="../assets/profile-images/Ellipse -7.png" required>
            <img class="profile" id='image4' src="../assets/profile-images/Ellipse -7.png">
          </label>
        </div>
      </div>
      <!-- UC 4 -->
      <div class="row-content">
        <label class="label text" for="gender">Gender</label>
        <div>
          <input type="radio" id="male" name="gender" value="male">
          <label class="text" for="male">Male</label>
          <input type="radio" id="female" name="gender" value="female">
          <label class="text" for="female">Female</label>
        </div>
      </div>
      <div class="row-content">
        <label class="label text" for="department">Department</label>
        <div>
            <input class="checkbox" type="checkbox" id="hr" name="department" value="HR">
            <label class="text" for="hr">HR</label>
            <input class="checkbox" type="checkbox" id="sales" name="department" value="Sales">
            <label class="text" for="sales">Sales</label>
            <input class="checkbox" type="checkbox" id="finance" name="department" value="Finance">
            <label class="text" for="finance">Finance</label>
            <input class="checkbox" type="checkbox" id="engineer" name="department" value="Engineer">
            <label class="text" for="engineer">Engineer</label>
            <input class="checkbox" type="checkbox" id="others" name="others" value="Others">
            <label class="text" for="others">Others</label>
        </div>
      </div>
      <div class="row-content">
        <label class="label text" for="salary">Choose your salary: </label>
        <input class="input" type="range" name="salary" id="salary" min="300000" 
               max="500000" step="100" value="400000" onChange="getSal()" >
        <output class="salary-output text" for="salary"></output>
        <error-output class="name-error" for="text" ></error-output> 
      </div>
      <!-- UC 5 -->
      <div class="row-content">
        <label class="label text" for="startDate">Start Date</label>
        <div>
          <select id="day" name="Day">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
            <option value="31">31</option>
          </select>
          <select id="month" name="Month">
            <option value="Jan">January</option>
            <option value="Feb">Febuary</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="Aug">August</option>
            <option value="Sept">September</option>
            <option value="Oct">October</option>
            <option value="Nov">November</option>
            <option value="Dec">December</option>
          </select>
          <select id="year" name="Year">
            <option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
          </select>
        </div>
      </div>
      <!-- UC 6 -->
      <div class="row-content">
        <label class="label text" for="notes">Notes</label>
        <textarea id="notes" class="input" name="Notes" placeholder="" style="height:100px"></textarea>
      </div>
      <div class="button-content">
        <a href="./home.html" class="resetButton button cancelButton">Cancel</a>
        <div class="submit-reset">
            <button type="submit" class="button submitButton" id="submitButton">Submit</button>
            <button type="reset" class="resetButton button">Reset</button>
        </div>
      </div>
    </form>
  </div> 
  <script defer src="../js/EmployeePayroll.js"></script>
  <script >
  

let isUpdate = false;
let employeePayrollObj = {};

window.addEventListener('DOMContentLoaded', (event) => {
    const name = document.querySelector('#name');
    name.addEventListener('input', function() {
        if(name.value.length == 0) {
            setTextValue('.text-error', "");
            return;
        }
        try {
            (new EmployeePayrollData()).name = name.value;
            setTextValue('.text-error', "");
        } catch (e) {
            setTextValue('.text-error', e);
        }
    });

    

    checkForUpdate();
});
const save = () => {
try {

    let employeePayrollData = createEmployeePayroll();
    //localStorage.setItem("empData",JSON.stringify(employeePayrollData));
    createAndUpdateStorage(employeePayrollData);
} catch (e) {
    return;
}

}
function createAndUpdateStorage(employeePayrollData){

    let employeePayrollList = JSON.parse(localStorage.getItem("EmployeePayrollList"));

    if(isUpdate==true)
    {
      const employeePayrollJson = localStorage.getItem('editEmp');
      employeePayrollObj = JSON.parse(employeePayrollJson);
      employeePayrollList= employeePayrollList.filter(x=>x.id!=employeePayrollObj.id)
       
        employeePayrollData.id=employeePayrollObj.id
        employeePayrollList.push(employeePayrollData);
        localStorage.removeItem('editEmp');
        isUpdate=false;
    }
    else if(employeePayrollList != undefined){
        var last=employeePayrollList.pop();
        employeePayrollData.id=last.id+1;
        employeePayrollList.push(last);
        employeePayrollList.push(employeePayrollData);
    } else{
      employeePayrollData.id=1;
        employeePayrollList = [employeePayrollData]
    }
   // alert(employeePayrollList.toString());
    localStorage.setItem("EmployeePayrollList", JSON.stringify(employeePayrollList))
}
const createEmployeePayroll = () => {
let employeePayrollData = new EmployeePayrollData();
try {
  employeePayrollData.name = getInputValueById('#name');
  employeePayrollData.salary=getInputValueById('#salary')
  employeePayrollData.gender=getSelectedValues('[name=gender]').pop();
  employeePayrollData.department = getSelectedValues('[name=department]');
  employeePayrollData.salary = getInputValueById('#salary');
  employeePayrollData.note = getInputValueById('#notes');
  employeePayrollData.profilePic=getSelectedValues('[name=profile]').pop();
  let date = getInputValueById('#day')+" "+getInputValueById('#month')+" "+
           getInputValueById('#year') ;
  employeePayrollData.date=date;
//employeePayrollData.date = Date.parse(date);
//alert(employeePayrollData.toString());
} catch (e) {
  setTextValue('.name-error', e);
  throw e;
}

return employeePayrollData;
}
const getInputValueById = (id) => {    
let value = document.querySelector(id).value;
return value;
}
const setTextValue = (id, value) => {
const element = document.querySelector(id);
element.textContent = value;
}

const getSelectedValues = (propertyValue) => {
let allItems = document.querySelectorAll(propertyValue);
let selItems = [];
allItems.forEach(item => {
  if(item.checked) selItems.push(item.value);
});    
return selItems;
} 

const setValue = (id, value) => {
    const element = document.querySelector(id);
    element.value = value;
}

const setSelectedIndex = (id, index) => {
    const element = document.querySelector(id);
    element.selectedIndex = index;
}

const resetForm = () => {
    setValue('#name','');
    unsetSelectedValues('[name=profile]');
    unsetSelectedValues('[name=gender]');
    unsetSelectedValues('[name=department]');
    setValue('#salary','');
    setValue('#notes','');
    setValue('#day','1');
    setValue('#month','January');
    setValue('#year','2020');
}
const unsetSelectedValues = (propertyValue) => {
    let allItems = document.querySelectorAll(propertyValue);
    allItems.forEach(item => {
        item.checked = false;
    });    
}
const checkForUpdate = () => {
    const employeePayrollJson = localStorage.getItem('editEmp');
    isUpdate = employeePayrollJson ? true : false;
    if (!isUpdate) return;
    employeePayrollObj = JSON.parse(employeePayrollJson);
    setForm();
}
const setSelectedValues = (propertyValue, value) => {
    let allItems = document.querySelectorAll(propertyValue);
    allItems.forEach(item => {
        if(Array.isArray(value)) {
            if (value.includes(item.value)) {
                item.checked = true;
            }
        }
        else if (item.value === value)
            item.checked = true;
    });    
}
const setForm = () => {
    setValue('#name', employeePayrollObj._name);
    setSelectedValues('[name=profile]', employeePayrollObj.profilePic);
    setSelectedValues('[name=gender]', employeePayrollObj.gender);
    setSelectedValues('[name=department]', employeePayrollObj.department);
    setValue('#salary',employeePayrollObj.salary);
    setTextValue('.salary-output', employeePayrollObj.salary);
    setValue('#notes',employeePayrollObj.note);
    let date = employeePayrollObj.date.split(" ");
    setValue('#day', date[0]);
    setValue('#month',date[1]);
    setValue('#year',date[2]);
}

</script>  

</body>
</html>